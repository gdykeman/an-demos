---
- name: Configure the CheckPoint
  hosts: chkpt
  connection: local
  gather_facts: False
  tasks:

    - name: wait for SSH prompt (timeout 10min)
      wait_for:
        port: 22
        host: "{{ ansible_host }}"
        timeout: 600

    - name: Find a private key to use
      set_fact:
        ssh_private_key: "{{ item }}"
      with_first_found:
        - files:
          - "{{ ansible_ssh_private_key_file }}"
          - "../{{ ansible_ssh_private_key_file }}"
          - '~/.ssh/id_rsa'
          - '~/.ssh/id_dsa'

    # Changing admin password
    - name: Set the CheckPoint admin password
      expect:
        command: ssh -i "{{ ssh_private_key }}" -o StrictHostKeyChecking=no admin@"{{ ansible_host }}" set user admin password
        echo: yes
        responses:
          password: "{{ network_password }}"
